{% extends "dashboard/base.html" %}
{% load staticfiles %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'dashboard/css/bootstrap-table.min.css' %}" type="text/css" media="screen" />
<link rel="stylesheet" href="{% static 'dashboard/css/select2.min.css' %}" type="text/css" media="screen" />
{% endblock css %}

{% block content %}

    <div class="container-fluid main" style="padding-top: 70px;">
        <div class="row text-left">

            <ol class="breadcrumb">
              <li><a href="{% url 'deliveries' %}">Copernicus QC Tool</a></li>
              <li class="active"><a href="">Results</a></li>
            </ol>

            <div class="main">
                <!-- Nav tabs -->
                <ul id="tabs_overview" class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active">
                        <a id="tab_overview" href="#recent" aria-controls="home" role="tab" data-toggle="tab">Result of QC Job: {{ job_uuid }}</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <p role="tabpanel" class="tab-pane active" id="recent">

                    <div class="panel panel-default"><div class="panel-body">
                    <dl class="row">
                      <dt class="col-sm-2">Product</dt>
                      <dd class="col-sm-10">{{description}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">Reference Year</dt>
                      <dd class="col-sm-10">{{reference_year}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">File</dt>
                      <dd class="col-sm-10">{{filename}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">Started</dt>
                      <dd class="col-sm-10">{{job_start_date}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">Finished</dt>
                      <dd class="col-sm-10">{{job_finish_date}}</dd>
                    </dl>
                </div></div>


                <table id="tbl-results" class="table" data-toggle="table" data-search-align="right" data-show-refresh="false" data-show-toggle="false" data-toolbar="#runs-toolbar-1" data-toolbar-align="left" data-show-filter="false" data-smart-display="true" data-sort-order="desc" data-show-export="false" data-pagination="false" data-side-pagination="server">
                    <thead>
                    <tr>
                        <th data-field="check_ident" data-sortable="false">Check</th>
                        <th data-field="check_description" data-sortable="false">Description</th>
                        <th data-field="check_result" data-sortable="false">Status</th>
                        <th data-field="check_attachments" data-sortable="false">Attachments</th>
                        <th data-field="check_message" data-sortable="false">Comments</th>
                    </tr>
                    </thead>
                   <tbody>
                        {% for step in steps %}
                        <tr>
                            {% if step.status == "ok" %}
                            <td class="success">{{step.check_ident}}</td>
                            <td class="success">{{step.description}}</td>
                            <td class="success">{{step.status}}</td>
                            <td class="success">
                                {% for attachment_filename in step.attachment_filenames %}
                                <a href="/attachment/{{ job_uuid }}/{{ attachment_filename }}">{{attachment_filename}}</a><br>
                                {% endfor %}</td>
                            <td class="success"><ul>{% for msg in step.messages %}<li>{{msg}}</li>{% endfor %}</ul></td>
                            {% elif step.status == "skipped" or step.status == "running" %}
                            <td>{{step.check_ident}}</td>
                            <td>{{step.description}}</td>
                            <td>{{step.status}}</td>
                            <td></td>
                            <td></td>
                            {% elif step.status == None %}
                            <td>{{step.check_ident}}</td>
                            <td>{{step.description}}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            {% else %}
                            <td class="danger">{{step.check_ident}}</td>
                            <td class="danger">{{step.description}}</td>
                            <td class="danger">{{step.status}}</td>
                            <td class="danger">
                                {% for attachment_filename in step.attachment_filenames %}
                                <a href="/attachment/{{ job_uuid }}/{{ attachment_filename }}">{{attachment_filename}}</a><br>
                                {% endfor %}</td>
                            <td class="danger"><ul>{% for msg in step.messages %}<li>{{msg}}</li>{% endfor %}</ul></td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                   </tbody>
                </table>
                <br>
                {% if job_finish_date %}
                    <a href="/data/report/{{ job_uuid }}/report.pdf"><i class="glyphicon glyphicon-file"></i>PDF Report</a>&nbsp;&nbsp;&nbsp;
                {% endif %}
                  <span>    </span><a href="/data/report/{{ job_uuid }}/{{ product_ident }}/report.json">JSON Report</a>&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;<span>    </span><a href="/data/wps_status/{{ job_uuid }}/">XML Report</a>

            </div>

        </div>
    </div>

    <br><br><br><br>

{% endblock content %}

{% block js %}
    {{ block.super }}
{% endblock js %}
