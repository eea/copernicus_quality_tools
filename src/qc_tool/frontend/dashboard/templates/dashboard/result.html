{% extends "dashboard/base.html" %}
{% load staticfiles %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'dashboard/css/bootstrap-table.min.css' %}" type="text/css" media="screen" />
<link rel="stylesheet" href="{% static 'dashboard/css/select2.min.css' %}" type="text/css" media="screen" />
{% endblock css %}

{% block content %}

    <div class="container-fluid main" style="padding-top: 70px;">
        <div class="row text-left">

            <ol class="breadcrumb">
              <li><a href="{% url 'deliveries' %}">Copernicus QC Tool</a></li>
              <li class="active"><a href="">Results</a></li>
            </ol>

            <div class="main">
                <!-- Nav tabs -->
                <ul id="tabs_overview" class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active">
                        <a id="tab_overview" href="#recent" aria-controls="home" role="tab" data-toggle="tab">Result of QC Job: {{ result.uuid }}</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <p role="tabpanel" class="tab-pane active" id="recent">

                    <div class="panel panel-default"><div class="panel-body">
                    <dl class="row">
                      <dt class="col-sm-2">Product</dt>
                      <dd class="col-sm-10">{{product_description}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">Reference Year</dt>
                      <dd class="col-sm-10">{{reference_year}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">File Path</dt>
                      <dd class="col-sm-10">{{filepath}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">Start Date/Time</dt>
                      <dd class="col-sm-10">{{start_time}}</dd>
                    </dl>
                    <dl class="row">
                      <dt class="col-sm-2">End Date/Time</dt>
                      <dd class="col-sm-10">{{end_time}}</dd>
                    </dl>
                </div></div>


                <table id="tbl-results" class="table" data-toggle="table" data-search-align="right" data-show-refresh="false" data-show-toggle="false" data-toolbar="#runs-toolbar-1" data-toolbar-align="left" data-show-filter="false" data-smart-display="true" data-sort-order="desc" data-show-export="false" data-pagination="false" data-side-pagination="server">
                    <thead>
                    <tr>
                        <th data-field="check_ident" data-sortable="false">Check</th>
                        <th data-field="check_description" data-sortable="false">Description</th>
                        <th data-field="check_result" data-sortable="false">Status</th>
                        <th data-field="check_attachments" data-sortable="false">Attachments</th>
                        <th data-field="check_message" data-sortable="false">Comments</th>
                    </tr>
                    </thead>
                   <tbody>
                        {% for detail in result.detail %}
                        <tr>
                            {% if detail.status == "ok" %}
                            <td class="success">{{detail.check_ident}}</td>
                            <td class="success">{{detail.description}}</td>
                            <td class="success">{{detail.status}}</td>
                            <td class="success">
                                {% for attachment_filename in detail.attachment_filenames %}
                                <a href="/attachment/{{ result.uuid }}/{{ attachment_filename }}">{{attachment_filename}}</a><br>
                                {% endfor %}</td>
                            <td class="success"><ul>{% for msg in detail.messages %}<li>{{msg}}</li>{% endfor %}</ul></td>
                            {% elif detail.status == "skipped" or detail.status == "running" %}
                            <td>{{detail.check_ident}}</td>
                            <td>{{detail.description}}</td>
                            <td>{{detail.status}}</td>
                            <td></td>
                            <td></td>
                            {% elif detail.status == None %}
                            <td>{{detail.check_ident}}</td>
                            <td>{{detail.description}}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            {% else %}
                            <td class="danger">{{detail.check_ident}}</td>
                            <td class="danger">{{detail.description}}</td>
                            <td class="danger">{{detail.status}}</td>
                            <td class="danger">
                                {% for attachment_filename in detail.attachment_filenames %}
                                <a href="/attachment/{{ result.uuid }}/{{ attachment_filename }}">{{attachment_filename}}</a><br>
                                {% endfor %}</td>
                            <td class="danger"><ul>{% for msg in detail.messages %}<li>{{msg}}</li>{% endfor %}</ul></td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                   </tbody>
                </table>
                <br>
                {% if pdf_report_exists %}
                    <a href="/data/report/{{ result.uuid }}/report.pdf"><i class="glyphicon glyphicon-file"></i>PDF Report</a>&nbsp;&nbsp;&nbsp;
                {% endif %}
                  <span>    </span><a href="/data/report/{{ result.uuid }}/report.json">JSON Report</a>&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;<span>    </span><a href="/data/wps_status/{{ result.uuid }}/">XML Report</a>

            </div>

        </div>
    </div>

    <br><br><br><br>

{% endblock content %}

{% block js %}
    {{ block.super }}
{% endblock js %}
